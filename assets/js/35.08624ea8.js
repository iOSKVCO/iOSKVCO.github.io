(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{598:function(e,t,a){"use strict";a.r(t);var r=a(6),i=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("blockquote",[a("p",[e._v("利用xcode的命令行工具 "),a("code",[e._v("xcdeobulid")]),e._v(" 进行项目的编译打包，生成ipa包，并上传到fir")])]),e._v(" "),a("h1",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),a("p",[e._v("现在网上的自动打包教程几乎都还是"),a("code",[e._v("xcodebuild + xcrun")]),e._v("的方式先生成"),a("code",[e._v(".app")]),e._v("包 再生成"),a("code",[e._v(".ipa")]),e._v("包,结果弄了一整天硬是没成功~")]),e._v(" "),a("p",[e._v("后来发现"),a("code",[e._v("PackageApplication is deprecated")]),e._v("，悲剧。然后手动压缩的 "),a("code",[e._v(".ipa")]),e._v("包因为签名问题无法装到手机上。")]),e._v(" "),a("p",[e._v("后来用了"),a("code",[e._v("archive + -exportArchive")]),e._v("终于可以了~")]),e._v(" "),a("h1",{attrs:{id:"正文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正文"}},[e._v("#")]),e._v(" 正文")]),e._v(" "),a("h2",{attrs:{id:"xcodebuild"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xcodebuild"}},[e._v("#")]),e._v(" Xcodebuild")]),e._v(" "),a("p",[a("strong",[e._v("xcodebuild")]),e._v(" 的使用可以用 "),a("code",[e._v("man xcodebuild")]),e._v("查看。")]),e._v(" "),a("p",[e._v("查看项目详情")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("# cd 项目主目录\nxcodebuild -list\n")])])]),a("p",[e._v("输出项目的信息")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v('Information about project "StackGameSceneKit":\n    Targets:\n        StackGameSceneKit\n        StackGameSceneKitTests\n\n    Build Configurations:\n        Debug\n        Release\n\n    If no build configuration is specified and -scheme is not passed then "Release" is used.\n\n    Schemes:\n        StackGameSceneKit\n')])])]),a("p",[e._v("要留意 "),a("code",[e._v("Configurations")]),e._v("，"),a("code",[e._v("Schemes")]),e._v("这两个属性。")]),e._v(" "),a("h2",{attrs:{id:"自动打包流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动打包流程"}},[e._v("#")]),e._v(" 自动打包流程")]),e._v(" "),a("h3",{attrs:{id:"生成-archive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成-archive"}},[e._v("#")]),e._v(" 生成 archive")]),e._v(" "),a("p",[e._v("生成archive的命令是 "),a("code",[e._v("xcodebuild archive")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("xcodebuild archive -workspace ${project_name}.xcworkspace \\\n               -scheme ${scheme_name} \\\n               -configuration ${build_configuration} \\\n               -archivePath ${export_archive_path}\n")])])]),a("ul",[a("li",[a("p",[e._v("参数一：项目类型，，如果是混合项目 workspace 就用 "),a("code",[e._v("-workspace")]),e._v("，如果是 project 就用 "),a("code",[e._v("-project")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("-scheme")]),e._v("：项目名，上面"),a("code",[e._v("xcodebuild -list")]),e._v("中的 "),a("code",[e._v("Schemes")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("-configuration")]),e._v("：编译类型，在"),a("code",[e._v("configuration")]),e._v("选择, "),a("code",[e._v("Debug")]),e._v(" 或者 "),a("code",[e._v("Release")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("-archivePath")]),e._v("：生成 archive 包的路径，需要精确到 "),a("code",[e._v("xx/xx.archive")])])])]),e._v(" "),a("p",[e._v("首先需要创建一个"),a("code",[e._v("AdHocExportOptions.plist")]),e._v("文件")]),e._v(" "),a("h3",{attrs:{id:"导出ipa包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出ipa包"}},[e._v("#")]),e._v(" 导出ipa包")]),e._v(" "),a("p",[e._v("导出"),a("code",[e._v(".ipa")]),e._v("包经常会出现错误，"),a("s",[e._v("在ruby2.4.0版本中会报错，所以请使用其他版本的ruby")]),e._v(",最初的原因是使用了 ruby2.4.0 进行编译时出现的错误。")]),e._v(" "),a("p",[e._v("解决方法是低版本的 ruby 进行编译，如使用系统版本："),a("code",[e._v("rvm use system")]),e._v("。后面升级macOS系统（10.12.5）后发现 ruby2.4.0 能成功 导出ipa包了。")]),e._v(" "),a("p",[e._v("导出ipa包使用命令："),a("code",[e._v("xcodebuild -exportArchive")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("xcodebuild  -exportArchive \\\n            -archivePath ${export_archive_path} \\\n            -exportPath ${export_ipa_path} \\\n            -exportOptionsPlist ${ExportOptionsPlistPath}\n")])])]),a("ul",[a("li",[a("code",[e._v("archivePath")]),e._v("：上面生成 archive 的路径")]),e._v(" "),a("li",[a("code",[e._v("-exportPath")]),e._v("：导出 ipa包 的路径")]),e._v(" "),a("li",[a("code",[e._v("exportOptionsPlist")]),e._v("：导出 ipa包 类型，需要指定格式的"),a("code",[e._v("plist")]),e._v("文件，分别是"),a("code",[e._v("AppStroe")]),e._v("、"),a("code",[e._v("AdHoc")]),e._v("、"),a("code",[e._v("Enterprise")]),e._v(",如下图")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://ww3.sinaimg.cn/large/006tNc79gy1ff1bcz534ij30g609uq48.jpg",alt:""}})]),e._v(" "),a("p",[e._v("选择这三个类别需要分别创建三个"),a("code",[e._v("plist")]),e._v("文件：")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("AdHocExportOptionsPlist.plist")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://ww3.sinaimg.cn/large/006tNc79gy1ff1bhmwvxfj30ax01pdfu.jpg",alt:""}})])]),e._v(" "),a("li",[a("p",[a("code",[e._v("AppStoreExportOptionsPlist.plist")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://ww3.sinaimg.cn/large/006tNc79gy1ff1bijdlsgj30bh01st8q.jpg",alt:""}})])]),e._v(" "),a("li",[a("p",[a("code",[e._v("EnterpriseExportOptionsPlist.plist")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://ww4.sinaimg.cn/large/006tNc79gy1ff1bishpk8j30be01sglm.jpg",alt:""}})])])]),e._v(" "),a("h3",{attrs:{id:"上传到-fir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传到-fir"}},[e._v("#")]),e._v(" 上传到 Fir")]),e._v(" "),a("p",[e._v("将项目上传到 "),a("a",{attrs:{href:"https://fir.im",target:"_blank",rel:"noopener noreferrer"}},[e._v("Fir"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("下载 "),a("a",{attrs:{href:"https://github.com/FIRHQ/fir-cli/blob/master/doc/install.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("fir 命令行工具"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("gem install fir-cli\n")])])]),a("p",[e._v("获取 fir 的 API Token（右上角）")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://ww3.sinaimg.cn/large/006tNc79gy1ff28ccsqhyj304t07bwei.jpg",alt:""}})]),e._v(" "),a("p",[e._v("上传")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v('fir publish "ipa_Path" -T "firApiToken"\n')])])]),a("h2",{attrs:{id:"自动打包脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动打包脚本"}},[e._v("#")]),e._v(" 自动打包脚本")]),e._v(" "),a("p",[a("s",[e._v("再次提醒，请不要使用 ruby 2.4.0 运行该脚本！")]),e._v("，若在 ruby 2.4.0 下编译失败，请切换低版本的ruby。")]),e._v(" "),a("p",[e._v("切换完毕记得重新安装 fir 命令行工具。")]),e._v(" "),a("p",[e._v("脚本我fork了 "),a("a",{attrs:{href:"https://github.com/jkpang/PPAutoPackageScript",target:"_blank",rel:"noopener noreferrer"}},[e._v("jkpang"),a("OutboundLink")],1),e._v(" 的脚本进行修改，添加了自动上传到 fir 的功能。")]),e._v(" "),a("p",[e._v("使用方法在Github上有详细介绍。")]),e._v(" "),a("p",[e._v("GitHub："),a("a",{attrs:{href:"https://github.com/qiubaiying/iOSAutoArchiveScript",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/qiubaiying/iOSAutoArchiveScript"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"利用-自定义终端指令-简化打包过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-自定义终端指令-简化打包过程"}},[e._v("#")]),e._v(" 利用 自定义终端指令 简化打包过程")]),e._v(" "),a("p",[e._v("以zsh为例:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("open ~/.zshrc\n")])])]),a("p",[e._v("添加自定义命令 cd + sh")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("alias mybuild='cd 项目地址/iOSAutoArchiveScript/ &&  sh 项目地址/iOSAutoArchiveScript/iOSAutoArchiveScript.sh'\n")])])]),a("p",[e._v("这样打开终端输入"),a("code",[e._v("mybuild")]),e._v("，就可以轻松实现一键打包上传了")]),e._v(" "),a("blockquote",[a("p",[e._v("本文首次发布于 "),a("a",{attrs:{href:"http://qiubaiying.github.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("BY Blog"),a("OutboundLink")],1),e._v(", 作者 "),a("a",{attrs:{href:"http://github.com/qiubaiying",target:"_blank",rel:"noopener noreferrer"}},[e._v("@柏荧(BY)"),a("OutboundLink")],1),e._v(" ,转载请保留原文链接.")])])])}),[],!1,null,null,null);t.default=i.exports}}]);